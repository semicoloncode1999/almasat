<div class="col-12">
  <div class="d-flex justify-content-end buttons-group">
    <button class="btn btn-primary" (click)="controlView='add';resetData()"
    [disabled]="controlView=='add'">add</button>
    <!-- <button class="btn btn-secondary" (click)="controlView='data'" [disabled]="controlView=='data'">show data</button> -->
    <div class="dropdown">
      <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
        aria-expanded="false">
        show data
      </button>
      <ul class="dropdown-menu">
        @for (item of categories; track item) {
          <li><button class="dropdown-item" (click)="controlView=item">{{item}}</button></li>
        }
      </ul>
    </div>
  </div>

  @if (controlView=='add' || controlView=='edit') {
    <form class="form m-4" [formGroup]="product"
      (ngSubmit)="submit()">
      <!-- images -->
      <div class="form-group">
        <!-- upload input -->
        <div>
          <label for="images" class="drop-container" id="dropcontainer">
            <span class="drop-title">Drop files here <span class="text-info text-decoration-underline">or browse</span></span>
            <input type="file" id="images" class="file-upload" multiple accept="image/*" (change)="uploadImg($event)" required>
          </label>
        </div>
        <!-- images with a big size notification -->
        @if (bigImages.length) {
          <div class="alert alert-warning text-center p-1 m-1">
            you choose some images with a big size!,So they did't uploaded, please upload images with smaller size instead of them <br>
            <!-- [ * <span *ngFor="let itr of bigImages"> <b  class="text-decoration-underline"> {{itr.name}} </b> * </span> ]  -->
            <b>note </b>: max size is 1 MegaByte per image
          </div>
        }
        <!-- the loading notification -->
        @if (loadingMsg) {
          <small class="loading-text">
            <div class="spinner-grow" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>uploading...</small>
          }
          <!-- view the list of images and ordering them -->
          @if (!loadingMsg) {
            <div cdkDropList cdkDropListOrientation="horizontal" class="example-list text-center" (cdkDropListDropped)="drop($event)">
              @for (item of promoImages; track item; let i = $index) {
                <div class="example-box" cdkDrag>
                  <img [src]="item" alt="" class="image-product">
                  <span class="delete-image text-danger" (click)="del(i)"><i class="bi bi-x-circle"></i></span>
                </div>
              }
            </div>
          }
        </div>
        <!-- choose category -->
        <div class="form-group">
          <label for="category" class="important">select category</label>
          @if (controlView == 'edit') {
            <input type="text" class="form-control" formControlName="category" [readOnly]="controlView=='edit'">
          }
          @if (controlView == 'add') {
            <select name="category" id="category" class="form-select" formControlName="category">
              @for (item of categories; track item) {
                <option [value]="item">{{item}}</option>
              }
            </select>
          }
        </div>
        <!-- product title -->
        <div class="form-group">
          <label for="title" class="important">Add product title</label>
          <input type="text" id="title" class="form-control" placeholder="title" formControlName="title">
        </div>
        <!-- adding form details array  -->
        <div class="form-group" formArrayName="details">
          <label class="important">Add product details</label>
          <span class="btn btn-primary add-form-item" (click)="addFormDetails()"><span>+</span></span>
          <!-- fristly we call form array name -->
          <!--  then we loop on the inputs array by get function   =>  arrayname?.controls  &  the index -->
          @for (item of detailsArray?.controls ; track item; let i = $index) {
            <div class="inputs-group position-relative">
              <!-- then we bind the formGroupName in the form array    ==>>  [formGroupName]=" index in the array "   -->
              <ng-container [formGroupName]="i">
                <!-- and then write the input with   formControlName -->
                <textarea type="text" class="form-control" placeholder="details" formControlName="details" rows="2"></textarea>
                <!-- <input type="text" class="form-control" placeholder="details" formControlName="details" rows="2"> -->
                @if (detailsArray.length > 0) {
                  <div class="btn btn-danger remove-form-item"  (click)="removeDetail(i)"><span>-</span></div>
                }
              </ng-container>
            </div>
          }
        </div>
        <!-- adding form price array  -->
        <div class="form-group mt-3" formArrayName="prices">
          <label class="important">Add product net price</label>
          <!-- <div class="btn btn-primary add-form-item" (click)="addFormPrice()"><span>+</span></div> -->
          @for (item of priceArray?.controls; track item; let i = $index) {
            <div class="inputs-group position-relative">
              <!-- the price object  -->
              <ng-container [formGroupName]="i">
                <input type="number" class="form-control price-input" placeholder="price" formControlName="priceValue" #priceValue>
                <!-- <small [ngClass.text-danger]="priceValue">asd</small> -->
                <select name="country" id="country" class="form-select country-input" formControlName="countryCurrency" #countryCurrency>
                  @for (item of countries; track item) {
                    <option [value]="item"> {{item}}</option>
                  }
                </select>
                @if (controlView!='edit') {
                  <p class="price-show">{{priceValue.value}} {{countryCurrency.value}}</p>
                }
                <!-- <div class="btn btn-danger remove-form-item" *ngIf="priceArray.length > 0" (click)="removePrice(i)"><span>-</span></div> -->
              </ng-container>
            </div>
          }
        </div>
        <!-- product discount -->
        <div class="form-group">
          <label for="discount" class="important">Add product discount percent form 100% : </label>
          <input type="number" id="discount" class="form-control" placeholder="discount" formControlName="discount">
        </div>
        <!-- choose category -->
        <div class="form-group">
          <label for="productRate" class="important">product stars rate : </label>
          <select name="productRate" id="productRate" class="form-select productRate" formControlName="productRate">
            <option value="no-rate">no rate</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>
        <!-- Show it on the home page  -->
        <div class="form-group">
          <label>Show it on the home page : </label> <br>
          <span>
            <label for="showOnHomeYes" class="m-1 fs-6">yes</label>
            <input type="radio" name="showOnHome" id="showOnHomeYes" formControlName="showOnHome" value="true" checked>
          </span>
          <span class="m-3">
            <label for="showOnHomeNo" class="m-1 fs-6">no</label>
            <input type="radio" name="showOnHome" id="showOnHomeNo" formControlName="showOnHome" value="false">
          </span>
        </div>
        <!-- available  -->
        <div class="form-group">
          <label>available</label> <br>
          <span>
            <label for="categoryYes" class="m-1 fs-6">yes</label>
            <input type="radio" name="available" id="categoryYes" formControlName="available" value="true" checked>
          </span>
          <span class="m-3">
            <label for="categoryNo" class="m-1 fs-6">no</label>
            <input type="radio" name="available" id="categoryNo" formControlName="available" value="false">
          </span>
        </div>
        <!-- --- button submit --- -->
        <div class="text-center p-2">
          @if (promoImages.length && controlView=='add') {
            <button type="submit" class="btn btn-primary" [disabled]="loadingMsg">Add product</button>
          }
          @if (promoImages.length && controlView=='edit') {
            <button type="submit" class="btn btn-warning" [disabled]="loadingMsg">Edit product</button>
          }
        </div>
      </form>
    }

    @if (controlView !='add' && controlView !='edit') {
      <app-view-edit-prods [dataInputView]="controlView"
      (sendProduct)="getItem($event)"></app-view-edit-prods>
    }
  </div>